# Data Model: Development Tools and Configuration

**Feature**: 005-devtools-config  
**Date**: 2026-01-18

## Overview

This feature is a NixOS configuration feature, not a traditional application with persistent data entities. The "data model" describes the configuration structure and module organization.

---

## Configuration Entities

### 1. NixOS Modules

New modules to be created at the system level:

| Module Path | Purpose | Dependencies |
|-------------|---------|--------------|
| `modules/shell/default.nix` | System-level fish shell configuration | None |
| `modules/docker/default.nix` | Docker daemon and configuration | None |
| `modules/services/code-server.nix` | code-server web IDE service | Tailscale (existing) |

### 2. Home Manager Configuration

Extensions to `home/default.nix`:

| Section | Configuration |
|---------|---------------|
| `home.packages` | CLI tools: bat, eza, lazygit, gh, uv, terraform, 1password-cli, opencode, claude-code, zellij, nodejs |
| `programs.fish` | Shell configuration, abbreviations, aliases |
| `programs.fzf` | Fuzzy finder with fish integration |
| `programs.zellij` | Terminal multiplexer configuration |
| `programs.bat` | Syntax highlighting pager |
| `programs.eza` | Modern ls replacement |
| `programs.lazygit` | Git TUI configuration |
| `home.file.".zed_server"` | Zed remote server symlink |

---

## Module Relationships

```
flake.nix
    │
    ├── hosts/devbox/default.nix
    │       │
    │       ├── imports ─► modules/core/default.nix
    │       ├── imports ─► modules/networking/default.nix
    │       ├── imports ─► modules/networking/tailscale.nix
    │       ├── imports ─► modules/security/ssh.nix
    │       ├── imports ─► modules/user/default.nix
    │       │                    │
    │       │                    └── home-manager.users.devuser ─► home/default.nix
    │       │
    │       ├── imports ─► modules/shell/default.nix      [NEW]
    │       ├── imports ─► modules/docker/default.nix     [NEW]
    │       └── imports ─► modules/services/code-server.nix [NEW]
    │
    └── hosts/devbox-wsl/default.nix
            │
            ├── imports ─► (same modules, minus Docker)
            └── WSL-specific overrides
```

---

## Configuration State

### Service States

| Service | Managed By | Default State | Port |
|---------|------------|---------------|------|
| Docker daemon | systemd | enabled, running | N/A (socket) |
| code-server | systemd | enabled, running | 8080 |
| Tailscale | systemd | enabled, running | 41641 |

### Shell State

| Component | Location | Managed By |
|-----------|----------|------------|
| Fish config | `~/.config/fish/` | Home Manager |
| Zellij config | `~/.config/zellij/` | Home Manager |
| fzf config | Environment variables | Home Manager |
| Zed server | `~/.zed_server/` | Home Manager (symlink) |

---

## User Group Memberships

| Group | Purpose | Required For |
|-------|---------|--------------|
| `wheel` | sudo access | System administration |
| `docker` | Docker socket access | Running containers without sudo |
| `networkmanager` | Network config | Network management (optional) |
| `onepassword-cli` | 1Password CLI | Secure op binary access (created by programs._1password) |

---

## Validation Rules

### Assertions (from Constitution)

1. **Firewall enabled** - modules/networking/default.nix
2. **SSH password auth disabled** - modules/security/ssh.nix  
3. **SSH root login denied** - modules/security/ssh.nix
4. **User has valid SSH key** - modules/user/default.nix

### New Assertions

1. **Docker group membership** - User must be in docker group if Docker enabled
2. **Fish in /etc/shells** - programs.fish.enable must be true at NixOS level

---

## Environment Variables

Set via Home Manager `home.sessionVariables` or fish config:

| Variable | Value | Purpose |
|----------|-------|---------|
| `EDITOR` | `nvim` | Default editor (existing) |
| `PAGER` | `bat` | Use bat for paging |
| `FZF_DEFAULT_COMMAND` | `fd --type f` | fzf file search |
| `FZF_DEFAULT_OPTS` | `--height 40% --layout=reverse` | fzf appearance |

---

## File System Layout

### New Files Created

```
/home/devuser/
├── .config/
│   ├── fish/
│   │   ├── config.fish          # Generated by Home Manager
│   │   ├── fish_variables       # Fish variables (managed)
│   │   └── functions/           # Custom functions
│   ├── zellij/
│   │   └── config.kdl           # Zellij configuration
│   ├── lazygit/
│   │   └── config.yml           # Lazygit configuration
│   └── code-server/
│       └── config.yaml          # code-server user config (if needed)
├── .zed_server/                  # Symlink to Nix store
│   └── zed-remote-server-*      # Zed remote binary
└── .local/
    └── share/
        └── zellij/              # Zellij session data
```

### System Files Modified

```
/etc/
├── shells                        # Fish added
├── passwd                        # User shell changed to fish
└── group                         # docker group added

/run/
└── wrappers/
    └── bin/
        └── op                    # 1Password CLI wrapper (setgid)
```
