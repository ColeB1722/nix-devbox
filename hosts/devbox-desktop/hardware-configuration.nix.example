# Hardware Configuration Example for Headful NixOS Desktop
#
# This file is auto-generated by nixos-generate-config during installation.
# Copy your actual hardware-configuration.nix here after running:
#
#   nixos-generate-config --show-hardware-config > hosts/devbox-desktop/hardware-configuration.nix
#
# This example shows a typical desktop/workstation configuration.
# Your actual file will have different UUIDs and hardware-specific settings.

{
  config,
  lib,
  pkgs,
  modulesPath,
  ...
}:

{
  imports = [
    (modulesPath + "/installer/scan/not-detected.nix")
  ];

  # ─────────────────────────────────────────────────────────────────────────────
  # Boot Configuration
  # ─────────────────────────────────────────────────────────────────────────────
  # Your actual boot config depends on UEFI vs BIOS and disk setup

  boot.initrd.availableKernelModules = [
    "xhci_pci"
    "ahci"
    "nvme"
    "usbhid"
    "usb_storage"
    "sd_mod"
  ];

  boot.initrd.kernelModules = [ ];

  boot.kernelModules = [ "kvm-amd" ]; # or "kvm-intel" for Intel CPUs

  boot.extraModulePackages = [ ];

  # ─────────────────────────────────────────────────────────────────────────────
  # Filesystem Configuration
  # ─────────────────────────────────────────────────────────────────────────────
  # Replace UUIDs with your actual disk UUIDs from `blkid`

  fileSystems."/" = {
    device = "/dev/disk/by-uuid/XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX";
    fsType = "ext4";
    # For btrfs:
    # fsType = "btrfs";
    # options = [ "subvol=@" "compress=zstd" "noatime" ];
  };

  fileSystems."/boot" = {
    device = "/dev/disk/by-uuid/XXXX-XXXX";
    fsType = "vfat";
    options = [ "fmask=0077" "dmask=0077" ];
  };

  # Optional: separate /home partition
  # fileSystems."/home" = {
  #   device = "/dev/disk/by-uuid/YYYYYYYY-YYYY-YYYY-YYYY-YYYYYYYYYYYY";
  #   fsType = "ext4";
  # };

  swapDevices = [
    # { device = "/dev/disk/by-uuid/ZZZZZZZZ-ZZZZ-ZZZZ-ZZZZ-ZZZZZZZZZZZZ"; }
  ];

  # ─────────────────────────────────────────────────────────────────────────────
  # GPU Configuration
  # ─────────────────────────────────────────────────────────────────────────────
  # Uncomment the appropriate section for your GPU

  # AMD GPU (recommended for Wayland)
  # boot.initrd.kernelModules = [ "amdgpu" ];
  # services.xserver.videoDrivers = [ "amdgpu" ];

  # Intel GPU (integrated)
  # boot.initrd.kernelModules = [ "i915" ];
  # hardware.cpu.intel.updateMicrocode = lib.mkDefault config.hardware.enableRedistributableFirmware;

  # NVIDIA GPU (requires extra configuration in default.nix)
  # See hosts/devbox-desktop/default.nix for NVIDIA setup

  # ─────────────────────────────────────────────────────────────────────────────
  # CPU Configuration
  # ─────────────────────────────────────────────────────────────────────────────

  # AMD CPU
  hardware.cpu.amd.updateMicrocode = lib.mkDefault config.hardware.enableRedistributableFirmware;

  # Intel CPU (uncomment if using Intel)
  # hardware.cpu.intel.updateMicrocode = lib.mkDefault config.hardware.enableRedistributableFirmware;

  # ─────────────────────────────────────────────────────────────────────────────
  # Network Interfaces
  # ─────────────────────────────────────────────────────────────────────────────
  # Typically auto-detected, but you can specify here if needed

  # networking.interfaces.enp3s0.useDHCP = lib.mkDefault true;
  # networking.interfaces.wlp4s0.useDHCP = lib.mkDefault true;

  # Enable firmware for WiFi cards
  hardware.enableRedistributableFirmware = lib.mkDefault true;

  # ─────────────────────────────────────────────────────────────────────────────
  # Platform
  # ─────────────────────────────────────────────────────────────────────────────

  nixpkgs.hostPlatform = lib.mkDefault "x86_64-linux";
}
